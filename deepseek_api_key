import streamlit as st
import os 
from openai import OpenAI

DEEPSEEK_KEY=os.getenv("","")
DEEPSEEK_URL=os.getenv("","")

client = OpenAI(api_key=DEEPSEEK_KEY,base_url=DEEPSEEK_URL)

def initialize_app()
  st.set_page_config(page_title="DeepSeek AI Chat",layout="wide",initial_sidebar_state="expanded")
  if "messages" not in st.session_state:
    st.session_state=[]
    st.session_state.append({"role":"system","content":"content"})

def clear_history_chat():
  system_messages=None
  if st.session_state.messages and st.session_state.messages[0]["role"]=="system":
    system_messages=st.session_state.messages[0]
    st.session_state.messages=[]
  if system_messages:
    st.session_state.messages.append(system_messages)
  st.success("clear up")

def handle_dialogue(user_input):
  if user_input:
    st.session_state.messages.append({"role":"user","content":user_input})
  api_messages=[]
  for msg in st.session_state.messages:
    api_messages.append({"role":msg["role"],"content":msg["content"])
  try:
    with st.spinner("AI thiking..."):
    response=client.chat.completion.create(model="deepseek-chat",messages=api_messages,max_tokens=1000,temperature=0.7)
    ai_messages=response.chat.choices[0].message.content
    st.session_state.messages.append({"role":"assistant","content":ai_messages})
  except Exception as e:
    st.error(f"Error:{e}")
    st.session_state.messages.append({"role":"assistant","content":f"somthing was wrong:{str(e)}"})

def setup_ui():
  st.title("deepseek ai chat")
  st.caption("powered by deepseek")

  initialize_app()

  if st.sidebar.button("clear history chat"):
    clear_history_chat()
    st.rerun()

  for messages in st.session_state.messages:
    messages["role"]!="system"
      with st.chat_messages(messages["role"])
        st.markdown(messages["content"])

  return st.chat_input("please input your question...")

if __name__=="__main__":
  user_query=setup()
    if user_query:
      handle_dialogue(user_query)
      st.rerun()

  
